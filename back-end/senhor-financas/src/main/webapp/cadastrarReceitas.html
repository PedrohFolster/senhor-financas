<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Senhor Finanças</title>
    <link rel="stylesheet" href="./css/cadastroReceitas.css">
</head>

<body>
<header class="lateral">
    <div class="imagem">
        <img class="logo" src="./imagens/logo.jpg" alt="Logo da página inicial" width="75%" height="75%">
    </div>
    <div class="texto">
        <h3>Gerenciador Financeiro</h3>
    </div>
    <hr>
    <section class="links">
        <ul>
            <li class="btn"><a href="./receitas.html">Receitas</a></li>
            <li class="btn"><a href="./despesas.html">Despesas</a></li>
            <li class="btn"><a href="./relatorios.html">Relatórios</a></li>
        </ul>
    </section>
</header>
<section class="principal">
    <div class="titulo">
        <h2>Cadastro de Receitas</h2>
    </div>
</section>
<form onsubmit="event.preventDefault(); cadastrarReceita();">
    <section class="cadastro-receitas">
        <div class="div-input-receitas">
            <label for="descricao">Descricao:</label>
            <input class="input-receitas" type="text" name="descricao" id="descricao" required>
        </div>
        <div class="div-input-receitas">
            <label for="descricao">Data da Receita:</label>
            <input class="input-receitas" type="date" name="dtreceita" id="dtreceita" required>
        </div>
        <div class="div-input-receitas">
            <label for="descricao">Valor:</label>
            <input class="input-receitas" type="number" name="valor" id="valor" required>
        </div>
    </section>
    <section class="botao-cadastrar-receitas">
        <div class="receitas-cadastrar">
            <div class="input-cadastrar-receitas">
            </div>
            <div class="cadastro-receitas">
                <button class="cadastrar-botao" type="submit">Cadastrar</button>
            </div>
        </div>
    </section>
</form>

<section class="desenvolvido">
    <h3>Desenvolvido por PedroFolster</h3>
</section>


<script>
    function formatDateTime(date) {
        const year = date.getUTCFullYear();
        const month = String(date.getUTCMonth() + 1).padStart(2, '0');
        const day = String(date.getUTCDate()).padStart(2, '0');
        const formattedDate = `${year}-${month}-${day}T00:00`;
        return formattedDate;
    }

    function cadastrarReceita() {
        const dataReceitaInput = document.getElementById('dtreceita');
        const descricao = document.getElementById('descricao').value;
        const valor = parseFloat(document.getElementById('valor').value);
        const idUsuario = 1;

        // Get the date value and format it as a datetime string
        const dataReceita = new Date(dataReceitaInput.value);
        console.log('Raw Date (Local Time):', dataReceita); // Log raw date for debugging

        // Convert to UTC before formatting
        const dataReceitaUTC = new Date(Date.UTC(
            dataReceita.getUTCFullYear(),
            dataReceita.getUTCMonth(),
            dataReceita.getUTCDate(),
            dataReceita.getUTCHours(),
            dataReceita.getUTCMinutes(),
            dataReceita.getUTCSeconds()
        ));

        const formattedDataReceita = formatDateTime(dataReceitaUTC);
        console.log('Formatted Date (UTC):', formattedDataReceita); // Log formatted date for debugging

        const receita = {
            dataReceita: formattedDataReceita,
            descricao: descricao,
            valor: valor,
            idUsuario: 1
        };

        fetch('http://localhost:8080/senhor_financas_war_exploded/rest/receita/cadastrar', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(receita),
        })
            .then(response => response.json())
            .then(data => {
                console.log('Receita cadastrada com sucesso:', data);
                // Additional logic if necessary
            })
            .catch((error) => {
                console.error('Erro ao cadastrar receita:', error);
                // Additional logic in case of an error
            });
    }
</script>

</body>

</html>
